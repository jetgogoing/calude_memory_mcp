# Claude记忆管理MCP服务 v1.4 环境配置模板
# 复制此文件为 .env 并填入实际值

# =====================================
# v1.4 核心配置
# =====================================

# SiliconFlow API配置 (v1.4: Qwen3模型主要提供商)
SILICONFLOW_API_KEY=sk-tjjznxtevmlynypmydlhqepnatclvlrimsygimtyafdoxklw
SILICONFLOW_BASE_URL=https://api.siliconflow.cn/v1

# 模型配置 (v1.4: 默认使用Qwen3系列)
DEFAULT_EMBEDDING_MODEL=qwen3-embedding-8b
DEFAULT_RERANK_MODEL=qwen3-reranker-8b
DEFAULT_LIGHT_MODEL=deepseek-v3
DEFAULT_HEAVY_MODEL=gemini-2.5-pro

# =====================================
# Qdrant向量数据库配置 (v1.4: 4096维)
# =====================================

QDRANT_URL=http://localhost:6333
QDRANT_API_KEY=
# v1.4: 新集合名称支持4096维向量
QDRANT_COLLECTION_NAME=claude_memory_vectors_v14
# v1.4: 向量维度升级到4096
QDRANT_VECTOR_SIZE=4096
QDRANT_DISTANCE_METRIC=Cosine
QDRANT_TIMEOUT=30

# =====================================
# 记忆系统配置 (v1.4: 简化配置)
# =====================================

# v1.4: MemoryFuser通过环境变量控制
MEMORY_FUSER_ENABLED=true
MEMORY_FUSER_MODEL=gemini-2.5-flash
MEMORY_FUSER_TEMPERATURE=0.2
MEMORY_FUSER_TOKEN_LIMIT=1200
MEMORY_FUSER_LANGUAGE=zh

# v1.4: 固定检索策略 Top-20→Top-5
MEMORY_RETRIEVAL_TOP_K=20
MEMORY_RERANK_TOP_K=5
MEMORY_SIMILARITY_THRESHOLD=0.7
MEMORY_HYBRID_SEARCH_ALPHA=0.5

# v1.4: 默认记忆模式
MEMORY_DEFAULT_MEMORY_MODE=embedding-only

# Token预算配置
MEMORY_TOKEN_BUDGET_LIMIT=6000
MEMORY_MAX_CONTEXT_TOKENS=4000
MEMORY_EMERGENCY_TOKEN_LIMIT=1000

# 记忆单元配置 (v1.4: 移除Quick-MU相关)
MEMORY_MAX_MEMORY_UNITS=10000
MEMORY_RETENTION_DAYS=365
# v1.4: Quick-MU相关配置已移除
# MEMORY_QUICK_MU_TTL_HOURS=24  # 已移除
MEMORY_GLOBAL_MU_GENERATION_INTERVAL_HOURS=168

# =====================================
# 成本控制配置 (v1.4: 优化目标)
# =====================================

# v1.4: 成本优化目标 $0.3-0.5/天
COST_MONTHLY_BUDGET_USD=100.0
COST_DAILY_BUDGET_USD=0.5
COST_TARGET_DAILY_COST_USD=0.4

# API预算分配
COST_GEMINI_BUDGET_PERCENTAGE=30.0
COST_OPENROUTER_BUDGET_PERCENTAGE=50.0
COST_SILICONFLOW_BUDGET_PERCENTAGE=20.0

# 成本控制策略
COST_ENABLE_COST_ALERTS=true
COST_AUTO_DEGRADATION_ENABLED=true
COST_ALERT_THRESHOLD=0.8

# =====================================
# 其他API配置 (备用)
# =====================================

# Gemini配置
GEMINI_API_KEY=AIzaSyDTBboAMDzVY7UMKK5gbNhwKufNTSDY0sw
GEMINI_MODEL=gemini-2.5-pro
GEMINI_EMBEDDING_MODEL=text-embedding-004

# OpenRouter配置
OPENROUTER_API_KEY=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
OPENROUTER_BASE_URL=https://openrouter.ai/api/v1

# =====================================
# 数据库配置
# =====================================

DATABASE_URL=sqlite:///./data/claude_memory.db
DATABASE_POOL_SIZE=10
DATABASE_MAX_OVERFLOW=20
DATABASE_POOL_TIMEOUT=30
DATABASE_ECHO=false

# =====================================
# 性能配置
# =====================================

# 并发控制
PERFORMANCE_MAX_CONCURRENT_REQUESTS=10
PERFORMANCE_REQUEST_TIMEOUT_SECONDS=30
PERFORMANCE_BATCH_SIZE=50

# 缓存配置
PERFORMANCE_CACHE_TTL_SECONDS=3600
PERFORMANCE_EMBEDDING_CACHE_SIZE=1000
PERFORMANCE_RESPONSE_CACHE_SIZE=500

# =====================================
# 监控配置
# =====================================

# Prometheus监控
MONITORING_ENABLE_METRICS=true
MONITORING_METRICS_PORT=9090

# 日志配置
MONITORING_LOG_LEVEL=INFO
MONITORING_LOG_FORMAT=json
MONITORING_LOG_FILE_PATH=./logs/claude_memory.log
MONITORING_LOG_ROTATION_SIZE=10MB
MONITORING_LOG_RETENTION_DAYS=30

# 告警配置
MONITORING_ALERT_EMAIL=
MONITORING_ALERT_WEBHOOK_URL=
MONITORING_LATENCY_ALERT_THRESHOLD_MS=500
MONITORING_ERROR_RATE_ALERT_THRESHOLD=0.05

# =====================================
# Claude CLI集成配置
# =====================================

CLI_CLAUDE_CLI_LOG_PATH=~/.claude/logs
CLI_CLAUDE_CLI_CONFIG_PATH=~/.claude/config
CLI_ENABLE_CLI_HOOKS=true
CLI_POLLING_INTERVAL_SECONDS=1

# 对话过滤配置
CLI_MIN_CONVERSATION_LENGTH=50
CLI_MAX_CONVERSATION_LENGTH=50000
CLI_EXCLUDE_SYSTEM_MESSAGES=true
CLI_INCLUDE_METADATA=true

# =====================================
# 应用基础配置
# =====================================

APP_NAME=Claude记忆管理MCP服务
APP_VERSION=1.4.0
APP_DEBUG=false
APP_HOST=0.0.0.0
APP_PORT=8000

# 安全配置
APP_SECRET_KEY=change-this-in-production
APP_API_TOKEN=
APP_CORS_ORIGINS=http://localhost:3000,http://localhost:8080

# =====================================
# 开发配置 (仅开发环境)
# =====================================

DEV_DEVELOPMENT_MODE=false
DEV_ENABLE_AUTO_RELOAD=false
DEV_ENABLE_DEBUG_LOGGING=false

# 测试配置
DEV_TEST_DATABASE_URL=sqlite:///./test.db
DEV_TEST_QDRANT_URL=http://localhost:6333
DEV_PYTEST_TIMEOUT=300

# Mock配置
DEV_MOCK_AI_RESPONSES=false
DEV_MOCK_EMBEDDING_RESPONSES=false

# =====================================
# v1.4 迁移配置
# =====================================

# 迁移脚本配置
MIGRATION_BATCH_SIZE=100
MIGRATION_DRY_RUN=false
MIGRATION_RESUME=false
MIGRATION_VALIDATE_ONLY=false

# 数据迁移配置
MIGRATION_OLD_COLLECTION_NAME=claude_memory_vectors
MIGRATION_NEW_COLLECTION_NAME=claude_memory_vectors_v14
MIGRATION_PROGRESS_FILE=migration_progress_v14.json

# =====================================
# 注意事项
# =====================================

# 1. 首次使用v1.4前，必须运行数据迁移脚本：
#    python scripts/migrate_embeddings_v14.py --dry-run
#    python scripts/migrate_embeddings_v14.py

# 2. 验证升级结果：
#    python scripts/validate_v14_upgrade.py --full --performance

# 3. 监控成本：v1.4目标是日成本控制在$0.3-0.5之间

# 4. MemoryFuser开关：通过MEMORY_FUSER_ENABLED控制是否启用记忆融合

# 5. 固定检索策略：Top-20初检 → Top-5重排，无需手动配置